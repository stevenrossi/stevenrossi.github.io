<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Visualizing the age distribution of Women&#39;s World Cup squads using R - Steven Rossi</title><meta name="Description" content="Steven Rossi"><meta property="og:title" content="Visualizing the age distribution of Women&#39;s World Cup squads using R" />
<meta property="og:description" content="With the 2023 FIFA Women&rsquo;s World Cup kicking off today in Australia and New Zealand, I thought I would try to visualize some statistics for all of the participating players. Detailed data on the women&rsquo;s game is not as readily available as data on the men&rsquo;s game, so my focus is on some basic statistics for which data is likely to be available (e.g., player age, caps, goals, assists, etc.)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stevenrossi.github.io/posts/1-wwc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-21T23:12:51-07:00" />
<meta property="article:modified_time" content="2023-07-21T23:12:51-07:00" /><meta property="og:site_name" content="Steven Rossi" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Visualizing the age distribution of Women&#39;s World Cup squads using R"/>
<meta name="twitter:description" content="With the 2023 FIFA Women&rsquo;s World Cup kicking off today in Australia and New Zealand, I thought I would try to visualize some statistics for all of the participating players. Detailed data on the women&rsquo;s game is not as readily available as data on the men&rsquo;s game, so my focus is on some basic statistics for which data is likely to be available (e.g., player age, caps, goals, assists, etc.)."/>
<meta name="application-name" content="Steven Rossi">
<meta name="apple-mobile-web-app-title" content="Steven Rossi"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://stevenrossi.github.io/posts/1-wwc/" /><link rel="next" href="https://stevenrossi.github.io/posts/2-le_mans_2023/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Visualizing the age distribution of Women's World Cup squads using R",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/stevenrossi.github.io\/posts\/1-wwc\/"
        },"genre": "posts","keywords": "R, Football, Data Scraping, Visualization","wordcount":  3610 ,
        "url": "https:\/\/stevenrossi.github.io\/posts\/1-wwc\/","datePublished": "2023-07-21T23:12:51-07:00","dateModified": "2023-07-21T23:12:51-07:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Steven Rossi"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Steven Rossi">Steven Rossi</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/viz/"> Interactive Tools </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Steven Rossi">Steven Rossi</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/viz/" title="">Interactive Tools</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Visualizing the age distribution of Women's World Cup squads using R</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Steven Rossi</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-07-21">2023-07-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;3610 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;17 minutes&nbsp;</div>
        </div><div class="content" id="content"><p>With the 2023 FIFA Women&rsquo;s World Cup kicking off today in Australia and New Zealand, I thought I would try to visualize some statistics for all of the participating players. Detailed data on the women&rsquo;s game is not as readily available as data on the men&rsquo;s game, so my focus is on some basic statistics for which data is likely to be available (e.g., player age, caps, goals, assists, etc.).</p>
<p>A total of 32 teams qualify for the World Cup, which proceeds in two stages. First the teams are divided into 8 groups of 4, with each team playing every other team in their group once. Three points are earned for a win, 1 point for a draw, and no points for a loss. At the end of the group stage, the two teams in each group with the most points advance to a knockout stage in which teams are paired off &ldquo;tournament-style&rdquo; in a series of winner-takes-all matches.</p>
<p>Each of the 32 teams is required to register 23 players, of which 3 must be goalkeepers. This gives a total of 736 players competing in the tournament: 640 outfield players and 96 goalkeers.</p>
<h1 id="reading-in-data">Reading-in data</h1>
<p>The first order of business is acquiring squad lists for each team. I found an official PDF from FIFA listing the full squads for each team <a href="https://fdp.fifa.org/assetspublic/ce93/pdf/SquadLists-English.pdf" target="_blank" rel="noopener noreffer ">(link)</a> but the lists of players is spread across multiple tables and there is a lot of extraneous information - both of these things tend to cause problems for PDF-scraping tools. I instead found a Wikipedia article listing the players for each team <a href="https://en.wikipedia.org/wiki/2023_FIFA_Women%27s_World_Cup_squads" target="_blank" rel="noopener noreffer ">(link)</a> and figured these tables would be easier to retreive.</p>
<p>The <code>GET()</code> function in the <code>httr</code> package can be used to scrape websites for information. We can then use the <code>readHTMLTable()</code> function in the <code>XML</code> package read all of the tables in the scraped data:</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">XML</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wiki</span> <span class="o">&lt;-</span> <span class="nf">GET</span><span class="p">(</span><span class="s">&#34;https://en.wikipedia.org/wiki/2023_FIFA_Women%27s_World_Cup_squads&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wikiTables</span> <span class="o">&lt;-</span> <span class="nf">readHTMLTable</span><span class="p">(</span> <span class="n">doc</span><span class="o">=</span><span class="nf">content</span><span class="p">(</span><span class="n">wiki</span><span class="p">,</span><span class="s">&#34;text&#34;</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span> <span class="p">)</span>
</span></span></code></pre></div><br>
<p>As an aside, there is an specific order in which the 32 teams are listed in official FIFA communications. Specifically, teams are first ordered by group (Group A, Group B, etc.) and within those groups they are ordered alphabetically. The squads on the Wikipedia page we are scraping are listed in this official order.</p>
<p>Let&rsquo;s take a look at the <code>wikiTables</code> object:</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="nf">mode</span><span class="p">(</span><span class="n">wikiTables</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;list&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="nf">length</span><span class="p">(</span><span class="n">wikiTables</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 38
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="n">wikiTables[[1]]</span>
</span></span></code></pre></div><pre tabindex="0"><code>   No.\n Pos.\n                    Player\n                   Date of birth (age)\n Caps\n Goals\n                   Club\n
1      1    1GK                 Erin Nayler     (1992-04-17)17 April 1992 (aged 31)     84       0           IFK Norrköping
2      2    3MF Ria Percival (vice-captain)   (1989-12-07)7 December 1989 (aged 33)    163      15        Tottenham Hotspur
3      3    2DF               Claudia Bunge (1999-09-21)21 September 1999 (aged 23)     22       0        Melbourne Victory
4      4    2DF                     CJ Bott     (1995-04-22)22 April 1995 (aged 28)     38       3           Leicester City
5      5    2DF             Michaela Foster    (1999-01-09)9 January 1999 (aged 24)      6       0       Wellington Phoenix
6      6    3MF             Malia Steinmetz   (1999-01-18)18 January 1999 (aged 24)     20       0 Western Sydney Wanderers
7      7    2DF         Ali Riley (captain)   (1987-10-30)30 October 1987 (aged 35)    154       2               Angel City
8      8    3MF             Daisy Cleverley     (1997-04-30)30 April 1997 (aged 26)     31       2                  HB Køge
9      9    4FW                 Gabi Rennie       (2001-07-07)7 July 2001 (aged 22)     26       2 Arizona State Sun Devils
10    10    3MF               Annalie Longo       (1991-07-01)1 July 1991 (aged 32)    129      15      Christchurch United
11    11    3MF               Olivia Chance    (1993-10-05)5 October 1993 (aged 29)     45       2                   Celtic
12    12    3MF               Betsy Hassett     (1990-08-04)4 August 1990 (aged 32)    145      13       Wellington Phoenix
13    13    2DF               Rebekah Stott      (1993-06-17)17 June 1993 (aged 30)     90       4   Brighton &amp; Hove Albion
14    14    2DF                 Katie Bowen     (1994-04-15)15 April 1994 (aged 29)     94       3           Melbourne City
15    15    4FW              Paige Satchell     (1998-04-13)13 April 1998 (aged 25)     43       2       Wellington Phoenix
16    16    4FW                 Jacqui Hand  (1999-02-19)19 February 1999 (aged 24)     14       2             Åland United
17    17    4FW            Hannah Wilkinson       (1992-05-28)28 May 1992 (aged 31)    115      28           Melbourne City
18    18    4FW                  Grace Jale     (1999-04-10)10 April 1999 (aged 24)     17       2          Canberra United
19    19    2DF             Elizabeth Anton  (1998-12-12)12 December 1998 (aged 24)     19       0              Perth Glory
20    20    4FW          Indiah-Paige Riley  (2001-12-20)20 December 2001 (aged 21)      9       0            Brisbane Roar
21    21    1GK              Victoria Esson      (1991-03-06)6 March 1991 (aged 32)     16       0                  Rangers
22    22    4FW                 Milly Clegg   (2005-11-01)1 November 2005 (aged 17)      4       0       Wellington Phoenix
23    23    1GK                   Anna Leat      (2001-06-26)26 June 2001 (aged 22)     10       0              Aston Villa
</code></pre><br>
<p><code>wikiTables</code> is a list of length 38. The first element of <code>wikiTables</code> is a table of the New Zealand players, which is the first table to appear on the Wikipedia page. Checking further, we can confirm that the first 32 elements of <code>wikiTables</code> are the 32 squad tables listed on the Wikipedia page in the official order described above. We note, however, that these tables are not labelled. We&rsquo;ll need to label them somehow.</p>
<p>Elements 33-38 of <code>wikiTables</code> are statistics tables included at the end of the Wikipedia page. These elements would not be of interest to us but for one reason: the 36th element of <code>wikiTables</code> is a table of the average player age by country and is arranged in FIFA&rsquo;s official order:</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="n">wikiTables[[36]]</span>
</span></span></code></pre></div><pre tabindex="0"><code>               Nation\n Avg. Age\n                                Oldest player\n                         Youngest player\n
1           New Zealand       26.9                 Ali Riley (35 years, 263 days)          Milly Clegg (17 years, 261 days)
2                Norway       26.4              Maren Mjelde (33 years, 256 days)    Mathilde Harviken (21 years, 203 days)
3           Philippines       24.9               Tahnai Annis (34 years, 30 days)           Kaiya Jota (17 years, 165 days)
4           Switzerland         27           Gaëlle Thalmann (37 years, 183 days)           Livia Peng (21 years, 128 days)
5             Australia       27.4                 Aivi Luik (38 years, 124 days)          Mary Fowler (20 years, 156 days)
6                Canada         27         Christine Sinclair (40 years, 38 days)         Olivia Smith (18 years, 349 days)
7               Nigeria       26.4                  Onome Ebi (40 years, 73 days)         Rofiat Imuran (19 years, 33 days)
8   Republic of Ireland       28.5               Niamh Fahey (35 years, 280 days)          Abbie Larkin (18 years, 84 days)
9            Costa Rica       25.6              Carol Sánchez (37 years, 95 days)         Sheika Scott (16 years, 271 days)
10                Japan       24.8              Saki Kumagai (32 years, 276 days)          Maika Hamano (19 years, 72 days)
11                Spain       25.3           Jennifer Hermoso (33 years, 72 days)     Salma Paralluelo (19 years, 249 days)
12               Zambia       23.8                Susan Banda (33 years, 14 days)         Esther Banda (18 years, 241 days)
13                China       26.9                 Zhang Rui (34 years, 184 days)          Pan Hongyan (18 years, 202 days)
14              Denmark       26.1 Sanne Troelsgaard Nielsen (34 years, 339 days) Kathrine Møller Kühl (20 years, 106 days)
15              England       25.8              Laura Coombs (32 years, 172 days)       Katie Robinson (20 years, 346 days)
16                Haiti       22.3         Roselord Borgella (30 years, 110 days)       Darlina Joseph (19 years, 217 days)
17          Netherlands       25.7             Sherida Spitse (33 years, 52 days)        Wieke Kaptein (17 years, 325 days)
18             Portugal         27           Carolina Mendes (35 years, 235 days)   Francisca Nazareth (20 years, 245 days)
19        United States       28.3              Megan Rapinoe (38 years, 15 days)      Alyssa Thompson (18 years, 255 days)
20              Vietnam         27       Trần Thị Thùy Trang (34 years, 346 days)           Vũ Thị Hoa (19 years, 256 days)
21               Brazil       27.5                     Marta (37 years, 151 days)               Lauren (20 years, 310 days)
22               France       26.8          Eugénie Le Sommer (34 years, 63 days)        Laurina Fazer (19 years, 280 days)
23              Jamaica       24.9           Rebecca Spencer (32 years, 148 days)     Solai Washington (17 years, 292 days)
24               Panama       24.6            Farissa Córdoba (34 years, 20 days)       Deysiré Salazar (19 years, 77 days)
25            Argentina       27.2             Vanina Correa (39 years, 340 days)         Lara Esponda (17 years, 254 days)
26                Italy       25.9          Cristiana Girelli (33 years, 88 days)       Giulia Dragoni (16 years, 255 days)
27         South Africa         27               Noko Matlou (37 years, 293 days)        Wendy Shongwe (20 years, 183 days)
28               Sweden       28.5            Caroline Seger (38 years, 123 days)         Anna Sandberg (20 years, 58 days)
29             Colombia       25.1          Sandra Sepúlveda (35 years, 139 days)      Ana María Guzmán (18 years, 39 days)
30              Germany       26.3            Marina Hegering (33 years, 94 days)           Jule Brand (20 years, 277 days)
31              Morocco       25.6                Najat Badri (35 years, 62 days)          Sarah Kassi (19 years, 314 days)
32          South Korea       28.9               Kim Jung-mi (38 years, 277 days)           Casey Phair (16 years, 21 days)
</code></pre><br>
<p>We can grab the team names in proper order and use them to label the tables of players later:</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="n">teams</span> <span class="o">&lt;-</span> <span class="n">wikiTables[[36]]</span><span class="o">$</span><span class="n">Nation</span>
</span></span></code></pre></div><pre tabindex="0"><code>&gt; teams
 [1] &#34; New Zealand&#34;         &#34; Norway&#34;              &#34; Philippines&#34;         &#34; Switzerland&#34;        
 [5] &#34; Australia&#34;           &#34; Canada&#34;              &#34; Nigeria&#34;             &#34; Republic of Ireland&#34;
 [9] &#34; Costa Rica&#34;          &#34; Japan&#34;               &#34; Spain&#34;               &#34; Zambia&#34;             
[13] &#34; China&#34;               &#34; Denmark&#34;             &#34; England&#34;             &#34; Haiti&#34;              
[17] &#34; Netherlands&#34;         &#34; Portugal&#34;            &#34; United States&#34;       &#34; Vietnam&#34;            
[21] &#34; Brazil&#34;              &#34; France&#34;              &#34; Jamaica&#34;             &#34; Panama&#34;             
[25] &#34; Argentina&#34;           &#34; Italy&#34;               &#34; South Africa&#34;        &#34; Sweden&#34;             
[29] &#34; Colombia&#34;            &#34; Germany&#34;             &#34; Morocco&#34;             &#34; South Korea&#34; 
</code></pre><br>
<p>There&rsquo;s a space preceeding each team name, so let&rsquo;s get rid of that. Also, the name &ldquo;Republic of Ireland&rdquo; might take up a bit too much room in plots, so we might want to abbreviate it.</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="c1"># Replace &#34; &#34; with &#34;&#34; in teams</span>
</span></span><span class="line"><span class="cl"><span class="n">teams</span> <span class="o">&lt;-</span> <span class="nf">sub</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="n">replacement</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">teams</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Replace &#34;Republic&#34; with &#34;Rep.&#34; in teams</span>
</span></span><span class="line"><span class="cl"><span class="n">teams</span> <span class="o">&lt;-</span> <span class="nf">sub</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&#34;Republic&#34;</span><span class="p">,</span><span class="n">replacement</span><span class="o">=</span><span class="s">&#34;Rep.&#34;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">teams</span><span class="p">)</span>
</span></span></code></pre></div><br>
<h1 id="merging-datasets">Merging datasets</h1>
<p>Now let&rsquo;s merge the 32 team datasets into a single table. We want to retain all of the current columns, plus add a team column.</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="n">N</span> <span class="o">&lt;-</span> <span class="nf">length</span><span class="p">(</span><span class="n">teams</span><span class="p">)</span> <span class="c1"># Good idea to double-check that this is 32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Array to store players from all teams</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&lt;-</span> <span class="kc">NULL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Loop over all the teams</span>
</span></span><span class="line"><span class="cl"><span class="nf">for</span><span class="p">(</span> <span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="n">N</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">y</span> <span class="o">&lt;-</span> <span class="n">wikiTables[[i]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Add Team column to table</span>
</span></span><span class="line"><span class="cl">  <span class="n">teamVec</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="n">teams[i]</span><span class="p">,</span><span class="nf">nrow</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="n">teamVec</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Append to array x</span>
</span></span><span class="line"><span class="cl">  <span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><br>
<p><code>x</code> is now an array containing the Name, Age, etc. of all players across all teams. Let&rsquo;s take a look:</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="nf">dim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 736  10
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>  No.\n Pos.\n                    Player\n                   Date of birth (age)\n Caps\n Goals\n                   Club\n     teamVec
1     1    1GK                 Erin Nayler     (1992-04-17)17 April 1992 (aged 31)     84       0           IFK Norrköping New Zealand
2     2    3MF Ria Percival (vice-captain)   (1989-12-07)7 December 1989 (aged 33)    163      15        Tottenham Hotspur New Zealand
3     3    2DF               Claudia Bunge (1999-09-21)21 September 1999 (aged 23)     22       0        Melbourne Victory New Zealand
4     4    2DF                     CJ Bott     (1995-04-22)22 April 1995 (aged 28)     38       3           Leicester City New Zealand
5     5    2DF             Michaela Foster    (1999-01-09)9 January 1999 (aged 24)      6       0       Wellington Phoenix New Zealand
6     6    3MF             Malia Steinmetz   (1999-01-18)18 January 1999 (aged 24)     20       0 Western Sydney Wanderers New Zealand
Browse[1]&gt; tail(x)
    No.\n Pos.\n             Player\n                  Date of birth (age)\n Caps\n Goals\n                      Club\n     teamVec
731    18    1GK          Kim Jung-mi  (1984-10-16)16 October 1984 (aged 38)    135       0       Incheon Hyundai Steel South Korea
732    19    4FW          Casey Phair     (2007-06-29)29 June 2007 (aged 16)      0       0 Players Development Academy South Korea
733    20    2DF Kim Hye-ri (captain)     (1990-06-25)25 June 1990 (aged 33)    111       1       Incheon Hyundai Steel South Korea
734    21    1GK           Ryu Ji-soo (1997-09-03)3 September 1997 (aged 25)      0       0                   Seoul WFC South Korea
735    22    3MF           Bae Ye-bin  (2004-12-07)7 December 2004 (aged 18)      2       0            Uiduk University South Korea
736    23    4FW        Kang Chae-rim    (1998-03-23)23 March 1998 (aged 25)     24       6       Incheon Hyundai Steel South Korea
</code></pre><p><code>x</code> has 23 * 32 = 736 rows, which is reassuring. However, the column names all have extraneous characters - let&rsquo;s delete those. Let&rsquo;s also rename the date of birth column to avoid having spaces in column names.</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="n">cnames</span> <span class="o">&lt;-</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">wikiTables[[1]]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cnames</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span> <span class="n">cnames</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">cnames</span><span class="p">)</span><span class="m">-1</span> <span class="p">)</span>  <span class="c1"># remove last two characters</span>
</span></span><span class="line"><span class="cl"><span class="n">cnames[4]</span> <span class="o">&lt;-</span> <span class="s">&#34;DOB&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">colnames</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span><span class="s">&#34;Team&#34;</span><span class="p">)</span>
</span></span></code></pre></div><br>
<p>We want the ages of each player, which could be as simple as grabbing the last second or third characters from each date of birth entry. However, we cannot be sure of when exactly these ages were calculated. Ideally they would be calculated on the starting date of the tourament (July 20, 2023), so let&rsquo;s recalculate the ages ourselves. To avoid having the deal with leap years and other annoying edge cases, we can use the <code>age_calc()</code> function in the <code>eeptools</code> package to calculate the length of time between each player&rsquo;s date of birth and the starting date of the tournament.</p>
<p>We can easily modify every row of this column using the <code>mutate()</code> function within <code>dplyr</code>. While we&rsquo;re mutating, let&rsquo;s also convert all columns that should be numeric to numeric - the data scraping process created these as character objects.</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="c1"># Kick off date of the tournament</span>
</span></span><span class="line"><span class="cl"><span class="n">kickOffDate</span> <span class="o">&lt;-</span> <span class="nf">as.Date</span><span class="p">(</span><span class="s">&#34;2023-07-20&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">eeptools</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">mutate</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">DOB</span><span class="o">=</span><span class="nf">gsub</span><span class="p">(</span><span class="s">&#34;\\).*&#34;</span><span class="p">,</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="n">DOB</span><span class="p">),</span>          <span class="c1"># delete everything after closing paranthesis</span>
</span></span><span class="line"><span class="cl">             <span class="n">DOB</span><span class="o">=</span><span class="nf">substr</span><span class="p">(</span> <span class="n">DOB</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">DOB</span><span class="p">)</span> <span class="p">),</span>  <span class="c1"># delete opening paranthesis</span>
</span></span><span class="line"><span class="cl">             <span class="n">DOB</span><span class="o">=</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">DOB</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">             <span class="n">Age</span><span class="o">=</span><span class="nf">age_calc</span><span class="p">(</span><span class="n">dob</span><span class="o">=</span><span class="n">DOB</span><span class="p">,</span><span class="n">enddate</span><span class="o">=</span><span class="n">kickOffDate</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s">&#34;years&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">             <span class="n">AgeFloor</span><span class="o">=</span><span class="nf">floor</span><span class="p">(</span><span class="n">Age</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">             <span class="n">Caps</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">Caps</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">             <span class="n">Goals</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">Goals</span><span class="p">)</span> <span class="p">)</span>  
</span></span></code></pre></div><br>
<p><code>dplyr</code> has a many other useful functions for manipulating data, which can be demonstrated by calculating the average age by team. We use the <code>group_by()</code> function in <code>dplyr</code> to &ldquo;group&rdquo; the data according to teams, i.e., the subsequent <code>summarize()</code> function will by applied to teams individually. Finally we use the <code>arrange()</code> and <code>desc()</code> functions to arrange the teams as a descending function of average age. We use the pipe operator <code>%&gt;%</code> to string consecutive functions together, i.e., the output of a function is passed as the first argument to the subsequent function.</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="n">avgAgeTable</span> <span class="o">&lt;-</span> <span class="n">x</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">               <span class="nf">group_by</span><span class="p">(</span> <span class="n">Team</span> <span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">               <span class="nf">summarize</span><span class="p">(</span> <span class="n">avgAge</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">Age</span><span class="p">)</span> <span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">               <span class="nf">arrange</span><span class="p">(</span> <span class="nf">desc</span><span class="p">(</span><span class="n">avgAge</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">print.data.frame</span><span class="p">(</span><span class="n">avgAgeTable</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>              Team   avgAge
1      South Korea 29.38551
2  Rep. of Ireland 28.97519
3           Sweden 28.94628
4    United States 28.61482
5           Brazil 27.96971
6        Australia 27.89739
7        Argentina 27.69456
8     South Africa 27.55257
9          Vietnam 27.51609
10     Switzerland 27.49386
11        Portugal 27.44853
12           China 27.44172
13          Canada 27.41395
14     New Zealand 27.28457
15          France 27.21048
16         Nigeria 26.82680
17          Norway 26.82454
18         Germany 26.78976
19         Denmark 26.59683
20        Colombia 26.59666
21         England 26.39725
22           Italy 26.33088
23     Netherlands 26.23169
24      Costa Rica 26.12517
25         Morocco 26.06825
26           Spain 25.72335
27         Jamaica 25.44887
28     Philippines 25.33018
29           Japan 25.30414
30          Panama 25.07119
31          Zambia 23.86139
32           Haiti 22.90572
</code></pre><br>
<p>Another essential <code>dplyr</code> function is <code>filter()</code>, which returns rows that fulfill one or more conditions. We demonstrate <code>filter()</code> by checking to see whether the Goal column is nonzero for any of the goalkeepers. It&rsquo;s not impossible for a goalkeeper to have scored but it&rsquo;s an easy way of checking the data - if many goalkeepers have goals or if one keeper has many goals, that may be a red flag that an error has occured when reading-in the data.</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="c1"># Return list of goalkeepers</span>
</span></span><span class="line"><span class="cl"><span class="n">xGK</span> <span class="o">&lt;-</span> <span class="n">x</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">       <span class="nf">filter</span><span class="p">(</span> <span class="n">Pos.</span><span class="o">==</span><span class="s">&#34;1GK&#34;</span><span class="p">,</span>      <span class="c1"># First condition  - return only goalkeepers</span>
</span></span><span class="line"><span class="cl">               <span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">Goals</span><span class="p">)</span> <span class="p">)</span>   <span class="c1"># Second condition - ignore missing values</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">sum</span><span class="p">(</span><span class="n">xGK</span><span class="o">$</span><span class="n">Goals</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 0
</code></pre><br>
<p>There are goalkeeper goals in our dataset - this is reassuring that we read-in the data correctly.</p>
<br>
<h1 id="analyzing-the-data">Analyzing the data</h1>
<p>Now that we&rsquo;ve read-in the data we can see how complete the individual data attributes are. To do this, we check for NAs in the Age, Caps and Goals column:</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="n">nMissing</span> <span class="o">&lt;-</span> <span class="n">x</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">            <span class="nf">group_by</span><span class="p">(</span><span class="n">Team</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">            <span class="nf">summarize</span><span class="p">(</span><span class="n">Age</span>   <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">Age</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                      <span class="n">Caps</span>  <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">Caps</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                      <span class="n">Goals</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">Goals</span><span class="p">)))</span>
</span></span></code></pre></div><pre tabindex="0"><code>&gt; print.data.frame(nMissing)
              Team Age Caps Goals
1        Argentina   0   23    23
2        Australia   0    0     0
3           Brazil   0    0     0
4           Canada   0    0     0
5            China   0    0     0
6         Colombia   0    0     0
7       Costa Rica   0   23    23
8          Denmark   0    0     0
9          England   0    0     0
10          France   0    0     0
11         Germany   0    0     0
12           Haiti   0    0     0
13           Italy   0    0     0
14         Jamaica   0    0     0
15           Japan   0    0     0
16         Morocco   0   23    23
17     Netherlands   0    0     0
18     New Zealand   0    0     0
19         Nigeria   0    1     1
20          Norway   0    0     0
21          Panama   0    0     0
22     Philippines   0    0     0
23        Portugal   0    0     0
24 Rep. of Ireland   0    0     0
25    South Africa   0   23    23
26     South Korea   0    0     0
27           Spain   0    0     0
28          Sweden   0    0     0
29     Switzerland   0    0     0
30   United States   0    0     0
31         Vietnam   0    0     0
32          Zambia   0   23    23
</code></pre><br>
<p>Cap and Goal tallies are missing for five teams: Argentina, Costa Rica, Morocco, and South Africa. They are also missing for one Nigeria player.
Missing caps and goals for five teams is not ideal, so let&rsquo;s focus on analyzing the ages for now.</p>
<br>
<h1 id="visualizing-the-age-data">Visualizing the age data</h1>
<p>Let&rsquo;s visualize the distribution of ages within each team on a single plot. We&rsquo;ll need a grid of plots with 1 plot for each of the 32 teams, so a 4x8 plot is probably the way to go.</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="c1"># Create a file to save the plot to</span>
</span></span><span class="line"><span class="cl"><span class="nf">png</span><span class="p">(</span> <span class="n">file</span><span class="o">=</span><span class="s">&#34;WwcSquadsByAge.png&#34;</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="m">300</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="m">8.5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">9.5</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#34;in&#34;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Make a 4x8 grid of plots</span>
</span></span><span class="line"><span class="cl"><span class="nf">par</span><span class="p">(</span> <span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">8</span><span class="p">),</span> <span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">),</span> <span class="n">oma</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">xpd</span><span class="o">=</span><span class="kc">TRUE</span> <span class="p">)</span>
</span></span></code></pre></div><br>
<p>We loop over the teams, ordered from higher mean age to lowest, and plot the distribution of ages for each team. The y-axis will correspond to age. All players of a given age will then be plotted symmetrically about the y-axis of each team plot.</p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-R" data-lang="R"><span class="line"><span class="cl"><span class="n">bgs</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;black&#34;</span><span class="p">,</span><span class="s">&#34;blue&#34;</span><span class="p">,</span><span class="s">&#34;yellow&#34;</span><span class="p">,</span><span class="s">&#34;red&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ageRange</span> <span class="o">&lt;-</span> <span class="nf">range</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">Age</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Loop over all teams</span>
</span></span><span class="line"><span class="cl"><span class="nf">for</span><span class="p">(</span> <span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="n">N</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Get team - these are arranged from highest mean age to lowest</span>
</span></span><span class="line"><span class="cl">  <span class="n">team</span> <span class="o">&lt;-</span> <span class="n">avgAgeTable</span><span class="o">$</span><span class="n">Team[i]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Get players from this team</span>
</span></span><span class="line"><span class="cl">  <span class="n">x_i</span> <span class="o">&lt;-</span> <span class="nf">filter</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">Team</span><span class="o">==</span><span class="n">team</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Calculate number of players at each age</span>
</span></span><span class="line"><span class="cl">  <span class="n">y</span> <span class="o">&lt;-</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span><span class="n">AgeFloor</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">       <span class="nf">summarize</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">AgeFloor</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># We should also note which players are captains</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># There may be a captain or two co-captains, so maybe vector</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># of length 2 to store ages of possible captains</span>
</span></span><span class="line"><span class="cl">  <span class="n">capAge</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># Get the captains</span>
</span></span><span class="line"><span class="cl">  <span class="n">cap</span> <span class="o">&lt;-</span> <span class="nf">grepl</span><span class="p">(</span><span class="s">&#34;(captain)&#34;</span><span class="p">,</span><span class="n">x_i</span><span class="o">$</span><span class="n">Player</span><span class="p">,</span><span class="n">fixed</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="o">|</span> 
</span></span><span class="line"><span class="cl">         <span class="nf">grepl</span><span class="p">(</span><span class="s">&#34;(co-captain)&#34;</span><span class="p">,</span><span class="n">x_i</span><span class="o">$</span><span class="n">Player</span><span class="p">,</span><span class="n">fixed</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># If there are captains, get their ages</span>
</span></span><span class="line"><span class="cl">  <span class="nf">if</span><span class="p">(</span> <span class="nf">any</span><span class="p">(</span><span class="n">cap</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">capAge[1</span><span class="o">:</span><span class="nf">sum</span><span class="p">(</span><span class="n">cap</span><span class="p">)</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">x_i[cap</span><span class="p">,</span><span class="s">&#34;AgeFloor&#34;</span><span class="n">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Blank plot</span>
</span></span><span class="line"><span class="cl">  <span class="nf">plot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-6</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">ageRange</span><span class="o">+</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;n&#34;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">FALSE</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># Green plot background</span>
</span></span><span class="line"><span class="cl">  <span class="nf">rect</span><span class="p">(</span> <span class="n">xleft</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="s">&#34;usr&#34;</span><span class="p">)</span><span class="n">[1]</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">ybottom</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="s">&#34;usr&#34;</span><span class="p">)</span><span class="n">[3]</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">xright</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="s">&#34;usr&#34;</span><span class="p">)</span><span class="n">[2]</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">ytop</span> <span class="o">=</span> <span class="nf">par</span><span class="p">(</span><span class="s">&#34;usr&#34;</span><span class="p">)</span><span class="n">[4]</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span> <span class="o">=</span> <span class="s">&#34;chartreuse3&#34;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Title the plot with the team name</span>
</span></span><span class="line"><span class="cl">  <span class="nf">title</span><span class="p">(</span> <span class="n">main</span><span class="o">=</span><span class="n">team</span><span class="p">,</span> <span class="n">cex.main</span><span class="o">=</span><span class="m">1.3</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="m">0.2</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Thick horizontal at average age</span>
</span></span><span class="line"><span class="cl">  <span class="nf">abline</span><span class="p">(</span> <span class="n">h</span><span class="o">=</span><span class="n">avgAge[i</span><span class="p">,</span><span class="s">&#34;avgAge&#34;</span><span class="n">]</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">lwd</span><span class="o">=</span><span class="m">2</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># Thin grid lines</span>
</span></span><span class="line"><span class="cl">  <span class="nf">abline</span><span class="p">(</span> <span class="n">h</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="n">from</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">to</span><span class="o">=</span><span class="n">ageRange[2]</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="m">5</span><span class="p">),</span> <span class="n">col</span><span class="o">=</span><span class="s">&#34;lightgreen&#34;</span><span class="p">,</span> <span class="n">lty</span><span class="o">=</span><span class="m">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Draw box around plot</span>
</span></span><span class="line"><span class="cl">  <span class="nf">box</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># Plot y-axis if plotting on the left edge of the grid</span>
</span></span><span class="line"><span class="cl">  <span class="nf">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">%%</span> <span class="m">8</span> <span class="o">==</span> <span class="m">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">axis</span><span class="p">(</span> <span class="n">side</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">las</span><span class="o">=</span><span class="m">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Loop over ages</span>
</span></span><span class="line"><span class="cl">  <span class="nf">for</span><span class="p">(</span> <span class="n">j</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Get number of players at this age</span>
</span></span><span class="line"><span class="cl">    <span class="n">yn</span> <span class="o">&lt;-</span> <span class="nf">unlist</span><span class="p">(</span><span class="n">y[j</span><span class="p">,</span><span class="s">&#34;n&#34;</span><span class="n">]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Lay out the players horizontally</span>
</span></span><span class="line"><span class="cl">    <span class="nf">if</span><span class="p">(</span> <span class="n">yn</span> <span class="o">==</span> <span class="m">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">xpos</span> <span class="o">&lt;-</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">else</span> <span class="nf">if</span><span class="p">(</span> <span class="n">yn</span> <span class="o">%%</span> <span class="m">2</span> <span class="o">==</span> <span class="m">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">xpos</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="n">from</span><span class="o">=-</span><span class="n">yn</span><span class="o">/</span><span class="m">2</span><span class="p">,</span><span class="n">to</span><span class="o">=</span><span class="n">yn</span><span class="o">/</span><span class="m">2</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="n">yn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">else</span>
</span></span><span class="line"><span class="cl">      <span class="n">xpos</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="n">from</span><span class="o">=</span><span class="nf">floor</span><span class="p">(</span><span class="o">-</span><span class="n">yn</span><span class="o">/</span><span class="m">2</span><span class="p">),</span><span class="n">to</span><span class="o">=</span><span class="nf">ceiling</span><span class="p">(</span><span class="n">yn</span><span class="o">/</span><span class="m">2</span><span class="p">),</span><span class="n">length.out</span><span class="o">=</span><span class="n">yn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># All players are black except captains who are red</span>
</span></span><span class="line"><span class="cl">    <span class="n">pchs</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="m">21</span><span class="p">,</span><span class="n">yn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">if</span><span class="p">(</span> <span class="n">y[j</span><span class="p">,</span><span class="s">&#34;AgeFloor&#34;</span><span class="n">]</span> <span class="o">%in%</span> <span class="n">capAge</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nf">if</span><span class="p">(</span> <span class="n">capAge[1]</span><span class="o">==</span><span class="n">capAge[2]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">pchs[1</span><span class="o">:</span><span class="m">2</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">24</span>
</span></span><span class="line"><span class="cl">      <span class="n">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">pchs[1]</span> <span class="o">&lt;-</span> <span class="m">24</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Get position code for each player at this age</span>
</span></span><span class="line"><span class="cl">    <span class="n">pos</span> <span class="o">&lt;-</span> <span class="nf">filter</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span><span class="n">AgeFloor</span><span class="o">==</span><span class="nf">unlist</span><span class="p">(</span><span class="n">y[j</span><span class="p">,</span><span class="s">&#34;AgeFloor&#34;</span><span class="n">]</span><span class="p">))</span><span class="o">$</span><span class="n">Pos.</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">           <span class="nf">substr</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">           <span class="nf">as.numeric</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Plot players</span>
</span></span><span class="line"><span class="cl">    <span class="nf">points</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="n">xpos</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="n">y[j</span><span class="p">,</span><span class="s">&#34;AgeFloor&#34;</span><span class="n">]</span><span class="p">,</span><span class="n">yn</span><span class="p">),</span> <span class="n">bg</span><span class="o">=</span><span class="n">bgs[pos]</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">pch</span><span class="o">=</span><span class="n">pchs</span><span class="p">,</span> <span class="n">lwd</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">cex</span><span class="o">=</span><span class="m">1.1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="c1"># next age</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Plot position legend above plot (1,7)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="m">7</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">par</span><span class="p">(</span><span class="n">xpd</span><span class="o">=</span><span class="kc">NA</span><span class="p">)</span>    <span class="c1"># Allow plotting in margins</span>
</span></span><span class="line"><span class="cl">    <span class="nf">legend</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s">&#34;topleft&#34;</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">-0.32</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="n">allPos</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">pch</span><span class="o">=</span><span class="m">21</span><span class="p">,</span> <span class="n">pt.bg</span><span class="o">=</span><span class="n">bgs</span><span class="p">,</span> <span class="n">horiz</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">pt.lwd</span><span class="o">=</span><span class="m">1.5</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">par</span><span class="p">(</span><span class="n">xpd</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> <span class="c1"># Turn off plotting in margins</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Plot captain legend above plot (1,8)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="m">8</span> <span class="p">)</span>     <span class="c1"># Allow plotting in margins</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">par</span><span class="p">(</span><span class="n">xpd</span><span class="o">=</span><span class="kc">NA</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">legend</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s">&#34;topright&#34;</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">-0.32</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="s">&#34;Captain&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">pch</span><span class="o">=</span><span class="m">24</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">pt.lwd</span><span class="o">=</span><span class="m">1.5</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">par</span><span class="p">(</span><span class="n">xpd</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> <span class="c1"># Turn off plotting in margins</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1"># next team</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Axis label and plot title</span>
</span></span><span class="line"><span class="cl"><span class="nf">mtext</span><span class="p">(</span> <span class="n">side</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&#34;Age (yr)&#34;</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="m">3</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">par</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">mtext</span><span class="p">(</span> <span class="n">side</span><span class="o">=</span><span class="m">3</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&#34;2023 FIFA Women&#39;s World Cup Squads&#34;</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="m">1.2</span><span class="p">,</span> <span class="n">cex</span><span class="o">=</span><span class="m">1.3</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">par</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Turn off plotting device</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/post1/ageDistributionByTeam.png"
        data-srcset="/images/post1/ageDistributionByTeam.png, /images/post1/ageDistributionByTeam.png 1.5x, /images/post1/ageDistributionByTeam.png 2x"
        data-sizes="auto"
        alt="/images/post1/ageDistributionByTeam.png"
        title="AgesByTeam" /></p>
<h2 id="analysis">Analysis</h2>
<p>Some interesting observations become apparent upon viewing the chart.</p>
<p>South Korea and Haiti offer some important points of contrast. Not only are South Korea and Haiti the oldest and youngest squads on average, but South Korea&rsquo;s squad is quite evenly distributed - there are no more than two players at any age and there are just three players younger than 25 (though this does include the youngest player in the tournament, aged 16). In contrast, all of Haiti&rsquo;s players except for 1 are between 19 and 26 years old, including 6 players aged 19 and 4 players aged 20.</p>
<p>The Republic of Ireland has an older, tightly-clustered squad - 61% players between 26 and 30. The Irish squad has only three players younger than 26.</p>
<p>Expectedly, captains tend to be among the most senior squad players, though the captains of both Republic of Ireland and Zambia are younger than the average squad age.</p>
<p>In the men&rsquo;s game a premium is often placed on experience for goalkeepers and defenders, while younger players may be more likely to feature in midfield or attacking roles due to the increased mobility needed for these roles. There are some minor team-specific patterns to note from the plot. For exmaples, several teams feature two veteran goalies, (e.g., South Korea, Nigeria, Morocco, Panama).
It is difficult to discern any clear age patterns from this plot. However, we note that these age distributions may be skewed by presence of players who will play few if any minutes at the tournament. Re-plotting the age distributions after the tournament with such marginal players excluded may reveal more discernable patterns.</p>
<p>Some other anomalies:</p>
<p>-The United States&rsquo; youngest defender and midfield are 23 and 24 years old respectively. Only three players on the US squad are younger than 23 and all of those players are forwards.</p>
<p>-China and Spain have relatively young keepers. China&rsquo;s oldest GK is 25, while all of Spain&rsquo;s keepers are between 21 and 23.</p>
<h2 id="next-steps">Next steps</h2>
<p>It would be nice to make this plot interactive so that hovering over the individual points triggers a display of player-specific information. I&rsquo;ll attempt to construct such an interactive plot in Shiny or Tableau for one or more of the men&rsquo;s European club leagues when they kick off next month.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-07-21</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://stevenrossi.github.io/posts/1-wwc/" data-title="Visualizing the age distribution of Women&#39;s World Cup squads using R" data-hashtags="R,Football,Data Scraping,Visualization"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://stevenrossi.github.io/posts/1-wwc/" data-hashtag="R"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://stevenrossi.github.io/posts/1-wwc/" data-title="Visualizing the age distribution of Women&#39;s World Cup squads using R" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://stevenrossi.github.io/posts/1-wwc/" data-title="Visualizing the age distribution of Women&#39;s World Cup squads using R"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://stevenrossi.github.io/posts/1-wwc/" data-title="Visualizing the age distribution of Women&#39;s World Cup squads using R"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/r/">R</a>,&nbsp;<a href="/tags/football/">Football</a>,&nbsp;<a href="/tags/data-scraping/">Data Scraping</a>,&nbsp;<a href="/tags/visualization/">Visualization</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
            <a href="/posts/2-le_mans_2023/" class="next" rel="next" title="Visualizing the 2023 24 Hours of Le Mans results in R using website scraping and regular expressions">Visualizing the 2023 24 Hours of Le Mans results in R using website scraping and regular expressions<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Steven Rossi</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":-1},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
